import forte

refaset2 = -9.089187884511

molecule {
r1=1.65
    0 1
    Li      0.0  0.0  0.0
    H       0.0  0.0  r1
--
    H      0.0  0.0  4.8
    H      0.0  0.0  5.57
    
     units angstrom
     no_reorient
     symmetry c1
}

set {
  basis                  3-21g
  reference              rhf
  scf_type               direct
  diis                   true
  diis_start             11
  maxiter                300
  soscf                  true
  soscf_max_iter         35
  damping_percentage     40
  fail_on_maxiter        false
  e_convergence          12
  d_convergence          8
  docc                   [3]
}

E, wfn = energy('scf', return_wfn = True)

set forte {
  restricted_docc        [2]
  active                 [2]

# Embedding settings
  job_type ASET2
  embedding true
  embedding_threshold 0.5
  embedding_reference hf
  FRAG_DO_FCI         true # Do FCI for A

# Fragment methods and space info:
   active_space_solver    fci
   FRAG_CORRELATION_SOLVER     none
   FRAG_CORR_LEVEL        pt2
   INT_TYPE_FRAG          conventional

# Environment (interaction) methods
   FRAGMENT_DENSITY       FULL # Use FCI to compute exact density
   ENV_CORRELATION_SOLVER      mrdsrg
   ENV_CORR_LEVEL         pt2
   INT_TYPE_ENV           conventional

# DSRG settings
   s                      0
   threepdc               zero
   fci_maxiter            200
   root_sym               0
   nroot                  1
   root                   0
   dsrg_s                 0.5
   ntrial_per_root        10
}

Eforte, wfn = energy('forte', ref_wfn = wfn, return_wfn=True)
compare_values(refaset2,variable("CURRENT ENERGY"),8,"ASET2-[FCI] energy")
