# Test DF-CASSCF with Pople basis set and reading orbitals from nearby geometry

import forte

psi4_casscf_1 = -99.927778470824194  # @1.5
psi4_casscf_2 = -99.912645717934794  # @1.6

memory 500 mb

molecule HF{
  0 1
  F
  H  1 R
}

set globals{
  basis                   6-31g*
  reference               rhf
  d_convergence           8
  e_convergence           9
  frozen_docc             [1,0,0,0]
  restricted_docc         [1,0,1,1]
  active                  [2,0,0,0]
  scf_type                df
  df_basis_scf            cc-pvdz-jkfit
  mcscf_type              df
}

HF.R = 1.5
Ecas, wfn = energy('casscf', return_wfn=True)
compare_values(Ecas, psi4_casscf_1, 8, "PSI4 CASSCF energy @ 1.5")

set forte{
  job_type                casscf
  int_type                df
  frozen_docc             [1,0,0,0]
  restricted_docc         [1,0,1,1]
  active                  [2,0,0,0]
  casscf_ci_solver        fci
  casscf_maxiter          25
  casscf_e_convergence    7
  casscf_g_convergence    7
  print                   0
}
Ecas_1 = energy('forte')
compare_values(psi4_casscf_1, Ecas_1, 6, "FORTE CASSCF energy @ 1.5")

HF.R = 1.6
set forte {
  job_type                mcscf_two_step
  frozen_docc             [0,0,0,0]
  restricted_docc         [2,0,1,1]
}
Ecas_2, wfn2 = energy('forte', ref_wfn=wfn, return_wfn=True)
compare_values(psi4_casscf_2, Ecas_2, 6, "FORTE 2-step MCSCF energy @ 1.6")

set forte {
  job_type                newdriver
  df_basis_mp2            cc-pvdz-jkfit
  active_space_solver     detci
  frozen_docc             [1,0,0,0]
  restricted_docc         [1,0,1,1]
}
Ecas_2 = energy('forte', ref_wfn=wfn2)
compare_values(psi4_casscf_2, Ecas_2, 6, "FORTE CASCI (MCSCF) energy @ 1.6")
